{"version":3,"file":"calendar.js","sourceRoot":"","sources":["../sources/client/calendar.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-check\n'use strict'\n\n/**\n * Возвращает перечень дат для месяца\n * @param year Год\n * @param month Месяц (1-12)\n */\n\nfunction getMonthDates( year:number, month:number )\n{\n    const lastPrevDate = new Date(year, month  - 1, 0).getDate();\n    const lastCurDate = new Date(year, month, 0).getDate();\n    const firstDayOfWeek = getDayOfWeek(new Date( year, month - 1, 1));\n    const startFromPrevMonth = firstDayOfWeek !== 1;\n    const fromDate = startFromPrevMonth \n        ? lastPrevDate - firstDayOfWeek + 2\n        : 1 ;\n    const daysBeforeLastInMonth = lastCurDate + firstDayOfWeek - 1;\n    // const daysFromNextMonth = 7 - (daysBeforeLastInMonth % 7);\n\n    const weeksInMonth = Math.ceil(daysBeforeLastInMonth / 7); \n\n    /** @type { 'prev' | 'current' | 'next' } */\n    let monthType:string = startFromPrevMonth ? 'prev' : 'current';\n    let date:number = fromDate - 1 ;\n\n    const dates:Date[] = []; \n\n    for ( let i = 0; i < weeksInMonth * 7; i++)\n    {\n        date++;\n\n        let monthAddition:number; \n        \n        switch( monthType )\n        {\n            case 'prev': \n                monthAddition = -1;\n                if ( date > lastPrevDate )\n                {\n                    date = 1;\n                    monthType = 'current';\n                    monthAddition = 0;\n                }\n                break;\n            \n            case 'current':\n                monthAddition = 0;\n                if ( date > lastCurDate )\n                {\n                    date = 1;\n                    monthType = 'next';\n                    monthAddition = 1; \n                }\n                break;\n            \n            default:\n                monthAddition = 1;\n                break; \n        }\n\n        const newDate = new Date( year, month + monthAddition - 1, date );\n        \n        dates.push( newDate  );\n    }\n\n    return dates;\n\n} \n\n/**\n * возвращает день недели, 1-7 (с понедельника) \n * @param {Date} date Дата\n */\nfunction getDayOfWeek( date:Date )\n{\n    let day = date.getDay();\n    if (day === 0)\n    {\n        day = 7;\n    }\n    return day;\n}\n\n/**\n * Возвращает строку - название месяца\n * @param {number} month \n */\nfunction getMonthName( month:number )\n{\n    switch ( month )\n    {\n        case 1: \n            return \"Январь\";\n        case 2:\n            return \"Февраль\"\n        case 3:\n            return \"Март\";\n        case 4:\n            return \"Апрель\";\n        case 5:\n            return \"Май\";\n        case 6:\n            return \"Июнь\";\n        case 7:\n            return \"Июль\";\n        case 8:\n            return \"Август\";\n        case 9:\n            return \"Сентябрь\";\n        case 10:\n            return \"Октябрь\";\n        case 11:\n            return \"Ноябрь\";\n        case 12:\n            return \"Декабрь\";\n        default:\n            return '/0';\n    }\n}\n\n/**\n * Создает разметку ячейки календаря\n * @param todayDate Текущая дата \n * @param selectedMonth Выбранный месяц (1-12)\n * @param itemDate Дата ячейки календаря\n */\nfunction createCalendarItem( todayDate: Date, selectedMonth: number, itemDate: Date )\n{\n    const classNames:string[] = [];\n\n    \n    if ( selectedMonth - 1 != itemDate.getMonth() ) \n    {\n        classNames.push( 'other-month' );\n    }\n\n    if ( \n        ( todayDate.getFullYear() === itemDate.getFullYear() )\n        && ( todayDate.getMonth() === itemDate.getMonth() ) \n        && ( todayDate.getDate() === itemDate.getDate() )\n    )\n    {\n        classNames.push( 'today' );\n    }\n\n    \n    return /* html */ `\n        <li class = \"${classNames.join( ' ' )}\">\n            ${itemDate.getDate()}\n        </li>\n    `\n}\n\nconst currentDate: Date = new Date(); \nlet calendarYear: number = currentDate.getFullYear();\nlet calendarMonth: number = currentDate.getMonth() + 1;\n\n/**\n * Отрисовывает календарь\n */\nexport function makeCalendar()\n{\n    const calendarElement = <HTMLElement>document.querySelector( 'ul.calendar-dates' );\n    const monthName = <HTMLElement>document.querySelector( 'p.calendar-heading' );\n    \n    const today = new Date();\n   \n\n    const dates = getMonthDates( calendarYear, calendarMonth );\n    const html = dates \n        .map(\n            ( date ) => createCalendarItem( today, calendarMonth, date )\n        )\n        .join( ' ' );\n\n    calendarElement.innerHTML = html;\n    let newMonthName: string = getMonthName( calendarMonth );\n    monthName.innerHTML = newMonthName;\n}\n\n\n/**\n * Отображает следующий месяц календаря\n */\nexport function seeNextMonth()\n{\n    const calendarElement = <HTMLElement>document.querySelector( 'ul.calendar-dates' );\n    if ( calendarElement )\n    {\n        const calendarDates = calendarElement.childNodes;\n        let i: number;\n        for ( i = 0; i < calendarDates.length; i++ )\n        {\n            calendarElement.removeChild( calendarDates[i] );\n        }\n        \n        \n\n        if ( calendarMonth === 12 )\n        {\n            calendarMonth = 1;\n            calendarYear = calendarYear + 1;\n        }\n        else\n        {\n            calendarMonth = calendarMonth + 1;\n        }\n\n        makeCalendar();\n    }\n    \n}\n\n/**\n * отображает предыдущий месяц календаря\n */\nexport function seePrevMonth()\n{\n    const calendarElement = document.querySelector( 'ul.calendar-dates' );\n    if ( calendarElement )\n    {\n        const calendarDates = calendarElement.childNodes;\n        let i: number;\n        for ( i = 0; i < calendarDates.length; i++ )\n        {\n            calendarElement.removeChild( calendarDates[i] );\n        }\n\n        if ( calendarMonth === 1 )\n        {\n            calendarMonth = 12;\n            calendarYear = calendarYear - 1;\n        }\n        else\n        {\n            calendarMonth = calendarMonth - 1;\n        }\n\n        makeCalendar();\n    }\n    \n}\n\n"]}